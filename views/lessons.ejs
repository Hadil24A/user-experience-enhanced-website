<%- include('partials/head') %>
<%- include('./partials/navigatie', {current: '/lessons'}); %>
<main class="lessonsPage">
    <header>
        <h1>Lessons</h1>
        <ul class="phases">
            <li id="listening"><p>1.</p><p>Listening</p> <%- include('./partials/listeningSVG') %> </li>
            <li id="locked"><p>2.</p><p>Locked</p> <%- include('./partials/lockedSVG') %> </li>
        </ul>
    </header>

    <!-- OWN PLAYLIST -->

    <section>
        <h2>Own playlist</h2>
        <ul class="ownPlaylist">
            <a href="/add-a-playlist">
                <li class="makeAPlaylistBtn"> <%- include('./partials/plusSVG') %>
                    <p>Make a playlist!</p>
                    <p>Add your favourite stories in one playlist</p>
                </li>
            </a>
            <% playlist.forEach(playlist => { %>
                <li>
                    <% if (playlist.image) { %> 
                        <img src="https://fdnd-agency.directus.app/assets/<%= playlist.image.id %>" alt="playlist" 
                            height="<%= playlist.image.height %>" width="<%= playlist.image.width %>"> 
                        <%  } else { %>
                            <img src=./images/placeholder.png alt="placeholder">
                    <% } %>    
                    <p><%=playlist.title%></p>
                    <a href="#" class="playPlaylist" type="button"><%- include('./partials/playbuttonSVG') %> </a>
                    <p>31 min. 55sec</p>
                </li>
            <% }) %>

            <% newPlaylists.forEach(newPlaylists => { %>
                <li><%=newPlaylists%> </li>
            <% }) %>
        </ul>
    </section>

    <!-- ALL STORIES -->

    <section>
        <h3>All stories</h3>
        <article id="languageSelect">
            <% language.forEach(language => { %>
                <button id="languageButton" type="button">  
                    <% if (language.flag) { %>
                    <img src="https://fdnd-agency.directus.app/assets/<%= language.flag %>" alt="flag"> <% } %><p><%- language.language %></p></button>
            <% }) %> 
        </article>

        <a href="/stories">Show all</a>

        <ul class="stories">
            <% stories.forEach(story => { %>
                <li>
                    <% if (story.image) { %>
                        <img src="https://fdnd-agency.directus.app/assets/<%= story.image.id %>"alt="story" height="<%= story.image.height %>" width="<%= story.image.width %>"> 
                        <%  } else { %>
                           <img src=./images/placeholder.png alt="placeholder">
                    <% } %> 
                    <div class="storyInfo">
                        <p><strong><%= story.title %></strong></p>
                        <p><%= story.summary %></p>
            
                        <a href="#" class="playStory"> <%- include('./partials/playbutton2SVG') %>
                        <p>3 min. 5sec</p></a>  
                    </div>
                    <img src="/images/britishFlag.png" alt="flag" id="storyFlag">
                    <button class="downloadStory"> <%- include('./partials/downloadSVG') %> </button>
                    <button class="addToPlaylist"> <%- include('./partials/addSVG') %> </button>
                </li>
            <% }) %> 
        </ul>
        
        <div class="pages">
            <button id="previous"><</button>
            <button id="next">></button>
        </div>  
    </section>

    <!-- LIKED PLAYLISTS -->

    <section>
        <article class="likedPlaylists">
            <h4>Liked playlists</h4>
            <a href="#">
                <% let filteredPlaylist = playlist.filter(playlist => favourites[playlist.id]); %>
                <% if (filteredPlaylist.length > 0) { %>
                <ul class="playlist">
                    <% filteredPlaylist.forEach(playlist => { %>
                    <li>
                        <% if (playlist.image) { %> 
                        <img src="https://fdnd-agency.directus.app/assets/<%= playlist.image.id %>" alt="playlist" 
                            height="<%= playlist.image.height %>" width="<%= playlist.image.width %>"> 
                        <%  } else { %>
                        <img src="./images/placeholder.png" alt="placeholder">
                        <% } %>    
                        <p><%= playlist.title %></p>
                        <a href="#" class="playPlaylist" type="button"><%- include('./partials/playbuttonSVG') %> </a>
                        <p>31 min. 55sec</p>
    
                        <form method="POST" action="/<%= playlist.id %>/like-or-unlike">
                        <button class="unlike-button" title="unlike playlist" type="submit" name="action" value="unlike">                                        
                            <%- include('./partials/filledHeartSVG') %>
                        </button>
                        </form>
                    </li>
                    <% }) %>
                </ul>
                <% } else { %>
                <p class="no-playlist">You currently have no liked playlists</p>
                <% } %>
            </a>
        </article>
    </section>
    
    <!-- SUGGESTED PLAYLISTS -->
    
    <section>
        <h5>Suggested playlists</h5>
        <a href="#">
            <% if (playlist.filter(playlistItem => !favourites[playlistItem.id]).length > 0) { %>
            <ul class="playlist">
                <% playlist.filter(playlistItem => !favourites[playlistItem.id]).forEach(playlistItem => { %>
                    <li>
                        <% if (playlistItem.image) { %> 
                            <img src="https://fdnd-agency.directus.app/assets/<%= playlistItem.image.id %>" alt="playlist" 
                                height="<%= playlistItem.image.height %>" width="<%= playlistItem.image.width %>"> 
                        <%  } else { %>
                            <img src="./images/placeholder.png" alt="placeholder">
                        <% } %>    
                        <p><%= playlistItem.title %></p>
                        <a href="#" class="playPlaylist" type="button"><%- include('./partials/playbuttonSVG') %> </a>
                        <p>31 min. 55sec</p>
                        
                        <form method="POST" action="/<%= playlistItem.id %>/like-or-unlike">
                            <% if (!favourites[playlistItem.id]) { %>
                                <button title="like playlist" type="submit" name="action" value="like">
                                <%- include('./partials/heartSVG') %>
                                </button>
                            <% } else { %>
                                <button class="unlike-button" title="unlike playlist" type="submit" name="action" value="unlike">                                        
                                    <%- include('./partials/filledHeartSVG') %>
                                </button>
                            <% } %>
                        </form>
                    </li> 
                <% }) %>
            </ul>
            <% } else { %>
            <p class="no-playlist">No suggested playlists available.</p>
            <% } %>
        </a>
    </section>
    
    
    

</main>
<%- include('./partials/foot') %>
