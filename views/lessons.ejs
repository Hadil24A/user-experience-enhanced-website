<%- include('partials/head') %>
<%- include('./partials/navigatie', {current: '/lessons'}); %>
<main class="lessonsPage">
    <header>
        <h1>Lessons</h1>
        <ul class="phases">
            <li id="listening"><p>1.</p><p>Listening</p> <%- include('./partials/listeningSVG') %> </li>
            <li id="locked"><p>2.</p><p>Locked</p> <%- include('./partials/lockedSVG') %> </li>
        </ul>
    </header>

    <!-- OWN PLAYLIST -->

    <section>
        <h2>Own playlist</h2>
        <ul class="ownPlaylist">
            <a href="/add-a-playlist">
                <li class="makeAPlaylistBtn"> <%- include('./partials/plusSVG') %>
                    <p>Make a playlist!</p>
                    <p>Add your favourite stories in one playlist</p>
                </li>
            </a>
            <% playlist.forEach(playlist => { %>
                <li>
                    <% if (playlist.image) { %> 
                        <picture>
                            <source srcset="https://fdnd-agency.directus.app/assets/<%= playlist.image.id %>.avif" type="image/avif">
                            <source srcset="https://fdnd-agency.directus.app/assets/<%= playlist.image.id %>.webp" type="image/webp">
                        <img src="https://fdnd-agency.directus.app/assets/<%= playlist.image.id %>" alt="playlist" 
                            height="<%= playlist.image.height %>" width="<%= playlist.image.width %>">
                        </picture>
                        <%  } else { %>
                            <picture>
                                <img src="./images/placeholder.png" alt="placeholder">
                            </picture>
                    <% } %>    
                    <p><%=playlist.title%></p>
                    <a href="#" class="playPlaylist" type="button"><%- include('./partials/playbuttonSVG') %> </a>
                    <p>31 min. 55sec</p>
                </li>
            <% }) %>

            <% newPlaylists.forEach(newPlaylists => { %>
                <li><%=newPlaylists%> </li>
            <% }) %>
        </ul>
    </section>

    <!-- ALL STORIES -->

    <section>
        <h3>All stories</h3>
        <article id="languageSelect">
            <% language.forEach(language => { %>
                <button id="languageButton" type="button">  
                    <% if (language.flag) { %>
                    <picture>
                        <source srcset="https://fdnd-agency.directus.app/assets/<%= language.flag %>.avif" type="image/avif">
                        <source srcset="https://fdnd-agency.directus.app/assets/<%= language.flag %>.webp" type="image/webp">
                            <img src="https://fdnd-agency.directus.app/assets/<%= language.flag %>" alt="flag"> <% } %><p><%- language.language %></p></button>
                    </picture>
                <% }) %> 
        </article>

        <a href="/stories">Show all</a>

        <ul class="stories">
            <% stories.forEach(story => { %>
                <li>
                    <% if (story.image) { %>
                        <picture>
                            <source srcset="https://fdnd-agency.directus.app/assets/<%= story.image.id %>.avif" type="image/avif">
                            <source srcset="https://fdnd-agency.directus.app/assets/<%= story.image.id %>.webp" type="image/webp">
                                <img src="https://fdnd-agency.directus.app/assets/<%= story.image.id %>"alt="story" height="<%= story.image.height %>" width="<%= story.image.width %>"> 
                        </picture>
                        <%  } else { %>
                        <picture>
                            <img src=./images/placeholder.png alt="placeholder">
                        </picture>
                    <% } %> 
                    <div class="storyInfo">
                        <p><strong><%= story.title %></strong></p>
                        <p><%= story.summary %></p>
            
                        <a href="#" class="playStory"> <%- include('./partials/playbutton2SVG') %>
                        <p>3 min. 5sec</p></a>  
                    </div>
                    <picture>
                        <img src="/images/britishFlag.png" alt="flag" id="storyFlag">
                    </picture>
                    <button class="downloadStory"> <%- include('./partials/downloadSVG') %> </button>
                    <button class="addToPlaylist"> <%- include('./partials/addSVG') %> </button>
                </li>
            <% }) %> 
        </ul>
        
        <div class="pages">
            <button id="previous"><</button>
            <button id="next">></button>
        </div>  
    </section>

    <!-- LIKED PLAYLISTS -->

    <section>
        <% playlist.filter((playlist) => favourites[playlist.id]).forEach(playlist => { %>
            <article class="likedPlaylists">
              <h4>Liked playlists</h4>
              <ul class="playlist">
                <li>
                  <% if (playlist.image) { %>
                    <picture>
                        <source srcset="https://fdnd-agency.directus.app/assets/<%= playlist.image.id %>.avif" type="image.avif">
                        <source srcset="https://fdnd-agency.directus.app/assets/<%= playlist.image.id %>.webp" type="image.webp">
                            <img src="https://fdnd-agency.directus.app/assets/<%= playlist.image.id %>" alt="playlist" height="<%= playlist.image.height %>" width="<%= playlist.image.width %>">
                    </picture>
                            <% } else { %>
                    <picture>
                        <img src="./images/placeholder.png" alt="placeholder">
                    </picture>
                  <% } %>    
                  
                  <p><%= playlist.title %></p>
                  <a href="#" class="playPlaylist" type="button"><%- include('./partials/playbuttonSVG') %> </a>
                  <p>31 min. 55sec</p>
          
                  <form method="POST" action="/<%= playlist.id %>/like-or-unlike">
                    <input type="hidden" name="action" value="like">
                    <button class="like-button" title="like playlist" type="submit" name="action" value="like">                                        
                      <%- include('./partials/filledHeartSVG') %>
                    </button>
                  </form>
                </li>
              </ul>
            </article>
          <% }) %>
          <% if (!playlist.filter((playlist) => favourites[playlist.id]).length) { %>
            <p class="no-playlist">You currently have no liked playlists.</p>
          <% } %>          
    </section>
    
    <!-- SUGGESTED PLAYLISTS -->
    
    <section>
        <h5>Suggested playlists</h5>
        <% playlist.forEach(playlist => { %>
            <a href="#">
                <ul class="playlist">
                    <li>
                        <% if (playlist.image) { %> 
                            <picture>
                                <source srcset="https://fdnd-agency.directus.app/assets/<%= playlist.image.id %>.avif" type="image.avif">
                                <source srcset="https://fdnd-agency.directus.app/assets/<%= playlist.image.id %>.webp" type="image.webp">        
                                    <img src="https://fdnd-agency.directus.app/assets/<%= playlist.image.id %>" alt="playlist" 
                                height="<%= playlist.image.height %>" width="<%= playlist.image.width %>"> 
                            </picture>
                        <%  } else { %>
                            <picture>
                                <img src="./images/placeholder.png" alt="placeholder">
                            </picture>
                        <% } %>    
                        <p><%= playlist.title %></p>
                        <a href="#" class="playPlaylist" type="button"><%- include('./partials/playbuttonSVG') %> </a>
                        <p>31 min. 55sec</p>
    
                        <form method="POST" action="/<%= playlist.id %>/like-or-unlike">
                            <% if (!favourites[playlist.id]) { %>
                                <input type="hidden" name="action" value="like">
                                <button title="like playlist" type="submit" name="action" value="like">
                                <%- include('./partials/heartSVG') %>
                                </button>
    
                            <% } else { %>
                                <button class="unlike-button" title="unlike playlist" type="submit" name="action" value="unlike">                                        
                                    <%- include('./partials/filledHeartSVG') %>
                                </button>
                            <% } %>
                        </form>
                    </li> 
                </ul>
            </a>
        <% }) %>
        <% if (!playlist.length) { %>
            <p class="no-playlist">No suggested playlists available.</p>
        <% } %>
    </section>
</main>
<%- include('./partials/foot') %>
